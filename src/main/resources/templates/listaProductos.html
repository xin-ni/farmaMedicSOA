<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link th:href="@{/paginas/css/estilosAdmin.css}" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link th:href="@{/paginas/css/listaCategorias.css}" rel="stylesheet" type="text/css"/>   
    <link th:href="@{/paginas/css/modal.css}" rel="stylesheet" type="text/css"/>   
<style>
    
</style>
</head>
<body>
    <div th:replace="header.html"></div>
    <div class="contenedorInferior">
    <div th:replace="navbar.html"></div>
    <div class="contenedor-Info">
        <div class="contenedor-infoCabezera">
            <h1 class="text-titulo">Lista de Productos</h1>    
            <button class="boton-agregar" onclick="abrirModal()">Agregar nuevo Producto
            </button>
        </div>
        <div class="contenedor-buscar">
            <span class="opcion-buscar"> Buscar:</span>
            <input class="buscar-input"  type="text" id="searchInput" placeholder="Buscar por nombre">
        </div>
        
        <div class="table-container">

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Descripción</th>
                <th>Precio Compra</th>
                <th>Precio Venta</th>
                <th>Categoría</th>
                <th>Fecha Vencimiento</th>
                <th>Stock</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="producto : ${productos}">
                <td th:text="${producto.idProducto}"></td>
                <td th:text="${producto.nombreProducto}"></td>
                <td th:text="${producto.descripcionProducto}"></td>
             <!-- Supongamos que tienes dos elementos <td> con las clases "precioCompra" y "precioVenta" donde deseas mostrar los precios -->
<td class="precioCompra" th:text="${producto.precioCompraProducto}"></td>
<td class="precioVenta" th:text="${producto.precioVentaProducto}"></td>

                <td th:text="${producto.categoria.nombreCategoria}"></td>
                <td th:text="${#dates.format(producto.fechaVencimiento, 'dd-MM-yyyy')}"></td>
                <td th:text="${producto.stock}"></td>
                <td>
                    <a th:href="@{/entity/productos/editar/{id}(id=${producto.idProducto})}"><img th:src="@{/paginas/imagen/editImg.png}" alt="editar">
                    </a>
                    <a th:href="@{/entity/productos/eliminar/{id}(id=${producto.idProducto})}">
                        <img th:src="@{/paginas/imagen/eliminar.png}" alt="eliminar">
                    </a>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
</div>



</div>

<div id="modalCategoria" class="modal">
    <div class="modal-contentP">
        <span class="close" onclick="cerrarModal()">&times;</span>
        <h1>Crear nuevo producto</h1>
        <form th:action="@{/entity/productos/crear}" th:object="${nuevoProducto}" method="post">
            <div class="first-group">
                <div class="modal-nombre">
                    <label class="text-form" for="nombreProducto">Nombre:</label>
                    <input class="input-firstG" type="text" id="nombreProducto" th:field="*{nombreProducto}" required>
                </div>
                <div class="modal-categoria">
                    <label class="text-form" for="categoria">Categoría:</label>
                    <select class="input-firstG" id="categoria" th:field="*{categoria.idCategoria}" required>
                        <option th:each="categoria : ${categorias}" th:value="${categoria.idCategoria}" th:text="${categoria.nombreCategoria}"></option>
                    </select>
            </div>
        </div>

        <div class="second-group">
                <div class="modal-priceC">
                    <label class="text-form"  for="precioCompraProducto">Precio de compra:</label>
                    <input class="input-price" type="text" id="precioCompraProducto" th:field="*{precioCompraProducto}" required>
                </div>                
                <div class="modal-priceV">
                    <label class="text-form" for="precioVentaProducto">Precio de venta:</label>
                    <input class="input-price" type="text" id="precioVentaProducto" th:field="*{precioVentaProducto}" required>
                </div>
            <div class="modal-fechaNac">
                <label class="text-form" for="fechaVencimiento">Fecha de vencimiento:</label>
                <input class="input-fechaVen" type="date" id="fechaVencimiento" th:field="*{fechaVencimiento}" required>
            </div>
        </div>
          
            <div class="modal-stock">
                <label class="text-form" for="stock">Stock:</label>
                <input class="input-price" type="number" id="stock" th:field="*{stock}" required>
            </div>

            <div class="modal-descripcion">
                <label class="text-form" for="descripcionProducto">Descripción:</label>
                <input class="input-modalT" type="text" id="descripcionProducto" th:field="*{descripcionProducto}">
            </div>
            
            <button class="boton-guardarF" type="submit">Guardar</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Obtener todos los elementos con la clase "precioCompra" y "precioVenta"
        const precioCompraElements = document.querySelectorAll('.precioCompra');
        const precioVentaElements = document.querySelectorAll('.precioVenta');

        // Función para dar formato de moneda peruana a los elementos
        function formatearMonedaPeruana(elements) {
            elements.forEach(element => {
                // Obtener el valor numérico del elemento
                const precio = parseFloat(element.textContent);

                // Formatear el valor como moneda peruana (S/)
                const precioFormateado = new Intl.NumberFormat('es-PE', { style: 'currency', currency: 'PEN' }).format(precio);

                // Asignar el valor formateado de moneda al elemento
                element.textContent = precioFormateado;
            });
        }

        // Llamar a la función para formatear los precios de compra y venta
        formatearMonedaPeruana(precioCompraElements);
        formatearMonedaPeruana(precioVentaElements);
    });
</script>
<script>
    function abrirModal() {
        document.getElementById("modalCategoria").style.display = "block";
    }

    function cerrarModal() {
        document.getElementById("modalCategoria").style.display = "none";
    }
</script>
<script>
    document.getElementById('searchInput').addEventListener('input', function() {
      const query = this.value.toLowerCase();
      const rows = document.querySelectorAll('tbody tr');
  
      rows.forEach(function(row) {
        const nombre = row.children[1].textContent.toLowerCase();
        row.style.display = nombre.includes(query) ? 'table-row' : 'none';
      });
    });
  </script>
  


</body>
</html>